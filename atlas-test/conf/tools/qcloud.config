params {
    // Global peptides file references (updated to support both QC types)
    peptides_tsv_qc01 = "${params.home_dir}/mygit/atlas-config/atlas-test/assets/qcloud_qc01.tsv"
    peptides_tsv_qc02 = "${params.home_dir}/mygit/atlas-config/atlas-test/assets/qcloud_qc02.tsv"  
    
    // Default peptides file reference (for backward compatibility)
    peptides_tsv_file = "${params.home_dir}/mygit/atlas-config/atlas-test/assets/qcloud_qc01.tsv"

    // Configuration-driven QC type mapping (replaces hardcoded literals)
    qc_tsv_mapping = [
        // Original QC types
        'QC01': 'peptides_tsv_qc01',
        'QC02': 'peptides_tsv_qc02',
        
        // DIA QC types  
        'QCD1': 'peptides_tsv_qc01',
        'QCD2': 'peptides_tsv_qc02',
        
        // Bruker QC types
        'QCB1': 'peptides_tsv_qc01', 
        'QCB2': 'peptides_tsv_qc02'
    ]
    
    // Pattern-based mapping for flexible matching
    qc_tsv_pattern_mapping = [
        'QC.*1$': 'peptides_tsv_qc01',    // Any QC type ending in 1
        'QC.*2$': 'peptides_tsv_qc02'     // Any QC type ending in 2
    ]
    
    // MSnbaseXIC quantification parameters (grouped)
    msnbasexic_params = [
        output_dir       : ".",
        analyte_name     : "all",
        rt_tol_sec       : 120, // in seconds
        mz_tol_ppm       : 7,   // in ppm
        ms_level         : 1,
        plot_xic_ms1     : false,
        plot_xic_ms2     : false,
        plot_output_path : "results/plots",
        overwrite_tsv    : false
    ]

    // Qcloud mapping between 'params' with 'context_source'
    qcloud_terms = [
        tic                     : 'QC:9000005',  // TIC parameter ID
        mit_ms1                 : 'QC:9000002',  // MIT MS1 parameter ID
        mit_ms2                 : 'QC:9000002',  // MIT MS2 parameter ID (same as MS1)
        ms2_scan_count          : 'QC:9000001',  // MS2 scan count parameter ID
        num_prot_ungrouped      : 'QC:9000001',  // Number of ungrouped proteins
        num_pept_ungrouped      : 'QC:9000001',  // Number of ungrouped peptides
        num_psm                 : 'QC:9000001',  // Number of PSMs
        area                    : 'QC:1001844',
        rt                      : 'QC:1000894',
        dppm                    : 'QC:1000014',
        fwhm                    : 'QC:9000003',
        median_mass_acc_ms1     : 'QC:1000015',  // Median mass accuracy MS1
        median_mass_acc_ms2     : 'QC:1000015',  // Median mass accuracy MS2 (same qCCV as MS1)
        points_per_peak         : 'QC:9000010',  // Points per peak
        median_fwhm             : 'QC:9000003'   // Median FWHM
    ]

    // QCloud 'context_source' mappings
    qcloud_contexts = [
        tic                     : 'QC:0000048',  // TIC 
        mit_ms1                 : 'QC:1000927',  // MIT MS1 
        mit_ms2                 : 'QC:1000928',  // MIT MS2 
        ms2_scan_count          : 'QC:0000007',  // MS2 scan count
        num_prot_ungrouped      : 'QC:0000032',  // Number of ungrouped proteins
        num_pept_ungrouped      : 'QC:0000031',  // Number of ungrouped peptides
        num_psm                 : 'QC:0000029',  // Number of PSMs
        monitored_peptides      : 'QC:0000005',
        median_mass_acc_ms1     : 'QC:4000025',  // Median mass accuracy MS1 context
        median_mass_acc_ms2     : 'QC:4000026',  // Median mass accuracy MS2 context
        points_per_peak         : 'QC:4000027',  // Points per peak context
        median_fwhm             : 'QC:1010086'   // Median FWHM context
    ]

    // MS ontology references (expanded)
    ms_params = [
        total_tic      : 'MS:1000285',  // total ion current
        ms_type        : 'MS:1000511',  // ms level
        injection_time : 'MS:1000927',   // ion injection time
        ms_level       : 'MS:1000511'   // MS level
    ]

    // Map JSON basename patterns to QCloud term IDs
    json_pattern_map = [
        'FWHM*'                : qcloud_terms.fwhm,
        'Observed_RT_sec*'     : qcloud_terms.rt,
        'Total_Area*'          : qcloud_terms.area,
        'dmz_ppm*'             : qcloud_terms.dppm,
        'Points_per_peak*'     : qcloud_terms.points_per_peak,
        'Median_FWHM*'         : qcloud_terms.median_fwhm,
        'Median_Mass_Acc_MS1*' : qcloud_terms.median_mass_acc_ms1,
        'Median_Mass_Acc_MS2*' : qcloud_terms.median_mass_acc_ms2
    ]

    // QCloud peptide name mapping - from simple to OpenMS notation for QC01
    peptide_name_mapping_openms_notation = [
        "LVN": "LVNELTEFAK",
        "HLV": "HLVDEPQNLIK", 
        "VPQ": "VPQVSTPTLVEVSR",
        "EAC": "EAC(Carbamidomethyl)FAVEGPK",
        "EYE": "EYEATLEEC(Carbamidomethyl)C(Carbamidomethyl)AK",
        "ECC": "EC(Carbamidomethyl)C(Carbamidomethyl)HGDLLEC(Carbamidomethyl)ADDR",
        "SLH": "SLHTLFGDELC(Carbamidomethyl)K",
        "TCV": "TC(Carbamidomethyl)VADESHAGC(Carbamidomethyl)EK",
        "YIC": "YIC(Carbamidomethyl)DNQDTISSK",
        "NEC": "NEC(Carbamidomethyl)FLSHK"
    ]

    // QCD1 peptide name mapping (unmodified BSA peptides with trailing underscores)
    peptide_name_mapping_openms_notation_QCD1 = [
        "LVN": "LVNELTEFAK_",
        "HLV": "HLVDEPQNLIK_", 
        "VPQ": "VPQVSTPTLVEVSR_",
        "EAC": "EACFAVEGPK",
        "EYE": "EYEATLEECCAK",
        "ECC": "ECCHGDLLECADDR",
        "SLH": "SLHTLFGDELCK",
        "TCV": "TCVADESHAGCEK",
        "YIC": "YICDNQDTISSK",
        "NEC": "NECFLSHK"
    ]

    // QCloud peptide name mapping - from simple to OpenMS notation for QC02
    peptide_name_mapping_openms_notation_qc02 = [
        "YAE": "YAEAVTR",
        "TPA": "TPAQFDADELR",
        "STL": "STLTDSLVC(Carbamidomethyl)K",
        "SLA": "SLADELALVDVLEDK",
        "NPD": "NPDDITNEEYGEFYK",
        "LGD": "LGDLYEEEMR",
        "LAV": "LAVDEEENADNNTK",
        "FEE": "FEELNMDLFR",
        "EAA": "EAALSTALSEK",
        "DDV": "DDVAQTDLLQIDPNFGSK",
        "RFP": "RFPGYDSESK",
        "EVS": "EVSTYIK",
        "EAT": "EATTEFSVDAR",
        "FAF": "FAFQAEVNR",
        "EQF": "EQFLDGDGWTSR"
    ]

    
    // QCloud peptide name mapping - from simple to OpenMS notation for QCD2
    peptide_name_mapping_openms_notation_QCD2 = [
        "YAE": "YAEAVTR",
        "TPA": "TPAQFDADELR",
        "STL": "STLTDSLVC(Carbamidomethyl)K",
        "SLA": "SLADELALVDVLEDK",
        "NPD": "NPDDITNEEYGEFYK",
        "LGD": "LGDLYEEEMR",
        "LAV": "LAVDEEENADNNTK",
        "FEE": "FEELNMDLFR",
        "EAA": "EAALSTALSEK",
        "DDV": "DDVAQTDLLQIDPNFGSK",
        "RFP": "RFPGYDSESK",
        "EVS": "EVSTYIK",
        "EAT": "EATTEFSVDAR",
        "FAF": "FAFQAEVNR",
        "EQF": "EQFLDGDGWTSR"
    ]

    // QCloud peptide name mapping for QCB1 (Bruker QC01)
    peptide_name_mapping_openms_notation_QCB1 = [
        "LVN": "LVNELTEFAK",
        "HLV": "HLVDEPQNLIK", 
        "VPQ": "VPQVSTPTLVEVSR",
        "EAC": "EACFAVEGPK",
        "EYE": "EYEATLEECCAK",
        "ECC": "ECCHGDLLECADDR",
        "SLH": "SLHTLFGDELCK",
        "TCV": "TCVADESHAGCEK",
        "YIC": "YICDNQDTISSK",
        "NEC": "NECFLSHK"
    ]

    // QCloud peptide name mapping for QCB2 (Bruker QC02)
    peptide_name_mapping_openms_notation_QCB2 = [
        "YAE": "YAEAVTR",
        "TPA": "TPAQFDADELR",
        "STL": "STLTDSLVCK",
        "SLA": "SLADELALVDVLEDK",
        "NPD": "NPDDITNEEYGEFYK",
        "LGD": "LGDLYEEEMR",
        "LAV": "LAVDEEENADNNTK",
        "FEE": "FEELNMDLFR",
        "EAA": "EAALSTALSEK",
        "DDV": "DDVAQTDLLQIDPNFGSK",
        "RFP": "RFPGYDSESK",
        "EVS": "EVSTYIK",
        "EAT": "EATTEFSVDAR",
        "FAF": "FAFQAEVNR",
        "EQF": "EQFLDGDGWTSR"
    ]
}

// Process-specific configuration
process {
    withName: 'msnbasexic_pr' {
        ext.args = [
            "--output_dir ${params.msnbasexic_params.output_dir}",
            "--analyte_name ${params.msnbasexic_params.analyte_name}",
            "--rt_tol_sec ${params.msnbasexic_params.rt_tol_sec}",
            "--mz_tol_ppm ${params.msnbasexic_params.mz_tol_ppm}",
            "--msLevel ${params.msnbasexic_params.ms_level}",
            "--plot_xic_ms1 ${params.msnbasexic_params.plot_xic_ms1}",
            "--plot_xic_ms2 ${params.msnbasexic_params.plot_xic_ms2}",
            "--plot_output_path ${params.msnbasexic_params.plot_output_path}",
            "--overwrite_tsv ${params.msnbasexic_params.overwrite_tsv}"
        ].join(' ')
    }
}
